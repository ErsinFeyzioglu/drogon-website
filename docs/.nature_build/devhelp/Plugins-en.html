
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Plugins</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration File" href="Configuration-File-en.html" />
    <link rel="prev" title="DataBase FastDbClient" href="Database-FastDbclient-en.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Configuration-File-en.html" title="Configuration File"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Database-FastDbclient-en.html" title="DataBase FastDbClient"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">drogon v1.0.0-beta21 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index-en.html" accesskey="U">English documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="plugins">
<h1>Plugins</h1>
<p>Plugins are use to help users build complex applications. In Drogon, all plugins are built and installed into the application based on the configuration file. Plugins in Drogon are single-instance, and users can implement any functionality they want with plugins.</p>
<p>When Drogon runs the run() interface, it instantiates each plugin one by one according to the configuration file and calls the <em>initAndStart()</em> interface of them.</p>
<div class="section" id="configuration">
<h2>Configuration</h2>
<p>Plugin configuration is done through the configuration file, for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;plugins&quot;</span>: <span class="o">[</span>
    <span class="o">{</span>
    //name: The class name of the plugin
    <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;DataDictionary&quot;</span>,
    //dependencies: Plugins that the plugin depends on. It can be commented out
    <span class="s2">&quot;dependencies&quot;</span>: <span class="o">[]</span>,
    //config: The configuration of the plugin. This json object is the parameter to initialize the plugin.
    //It can be commented out
    <span class="s2">&quot;config&quot;</span>: <span class="o">{</span>
    <span class="o">}</span>
    <span class="o">}]</span>,
</pre></div>
</div>
<p>It can be seen that there are three configurations for each plugin:</p>
<blockquote>
<div><ul class="simple">
<li>name: is the class name of the plugin (including the namespace). The framework will create a plugin instance based on the class name. If the item is commented out, the plugin becomes disabled.</li>
<li>dependencies: Is a list of names of other plugins that the plugin depends on. The framework creates and initializes all plugins in a specific order. Prioritize the creation and initialization of plugins that are dependent by others. At the end of the program, plugins are closed and destroyed in reverse order. Please note that circular dependencies in plugins are forbidden. Drogon will report an error and exit the program if it detects a circular dependency. If the item is commented out, the list of dependencies is empty.</li>
<li>config: is the json object used to initialize the plugin, the object is passed as an input parameter to the plugin’s initAndStart() interface. If the item is commented out, the json object passed to the initAndStart interface is an empty object;</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="definition">
<h2>Definition</h2>
<p>User-defined plugins must inherit from the drogon::Plugin class template, and the template parameter is the plugin type, such as the following definition:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DataDictionary</span> <span class="o">:</span> <span class="k">public</span> <span class="n">drogon</span><span class="o">::</span><span class="n">Plugin</span><span class="o">&lt;</span><span class="n">DataDictionary</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">initAndStart</span><span class="p">(</span><span class="k">const</span> <span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="o">&amp;</span><span class="n">config</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">shutdown</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
    <span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<p>One can create source files of plugin by drogon_ctl command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>drogon_ctl create plugin &lt;<span class="o">[</span>namespace::<span class="o">]</span>class_name&gt;
</pre></div>
</div>
</div>
<div class="section" id="getting-instance">
<h2>Getting Instance</h2>
<p>The plugin instance is created by drogon, and the user can get the plugin instance through the following interface of drogon:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="o">*</span><span class="n">getPlugin</span><span class="p">();</span>
</pre></div>
</div>
<p>Or</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">PluginBase</span> <span class="o">*</span><span class="nf">getPlugin</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">);</span>
</pre></div>
</div>
<p>Obviously, the first method is more convenient. For example, the DataDictionary plugin mentioned above can be obtained like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="o">*</span><span class="n">pluginPtr</span><span class="o">=</span><span class="n">app</span><span class="p">().</span><span class="n">getPlugin</span><span class="o">&lt;</span><span class="n">DataDictionary</span><span class="o">&gt;</span><span class="p">();</span>
</pre></div>
</div>
<p>Note that it is best to get the plugin after calling the framework’s run() interface, otherwise one will get an uninitialized plugin instance (this doesn’t necessarily lead to an error, it is ok to just make sure to use the plugin after initialization). Of course, since the plugin is initialized in a dependency order, it is no problem to get the instance of another plugin in the <em>initAndStart()</em> interface.</p>
</div>
<div class="section" id="life-cycle">
<h2>Life Cycle</h2>
<p>All plugins are initialized in the run() interface of the framework and are destroyed when the application exits. Therefore, the plugin’s lifecycle is almost identical to the application, which is why the getPlugin() interface does not need to return a smart pointer.</p>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Configuration-File-en.html" title="Configuration File"
             >next</a> |</li>
        <li class="right" >
          <a href="Database-FastDbclient-en.html" title="DataBase FastDbClient"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">drogon v1.0.0-beta21 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index-en.html" >English documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, an-tao.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>