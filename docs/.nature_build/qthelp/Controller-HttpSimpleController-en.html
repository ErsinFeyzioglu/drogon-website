<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Controller HttpSimpleController</title>
    <link rel="stylesheet" href="_static/nonav.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="controller-httpsimplecontroller">
<h1>Controller HttpSimpleController</h1>
<p>You could use the <em>drogon_ctl</em> command line tool to quickly generate custum controller class source files based on <em>HttpSimpleController</em>, the command format is as bellow:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>drogon_ctl create controller &lt;<span class="o">[</span>namespace::<span class="o">]</span>class_name&gt;
</pre></div>
</div>
<p>We create one controller class named <em>TestCtrl</em>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>drogon_ctl create controller TestCtrl
</pre></div>
</div>
<p>As you can see, there are two new files, TestCtrl.h and TestCtrl.cc. Now, let’s have a look at them:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><strong>TestCtrl.h：</strong></span></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>
<span class="cp">#include</span> <span class="cpf">&lt;drogon/HttpSimpleController.h&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">drogon</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">TestCtrl</span><span class="o">:</span><span class="k">public</span> <span class="n">drogon</span><span class="o">::</span><span class="n">HttpSimpleController</span><span class="o">&lt;</span><span class="n">TestCtrl</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">asyncHandleHttpRequest</span><span class="p">(</span><span class="k">const</span> <span class="n">HttpRequestPtr</span> <span class="o">&amp;</span><span class="n">req</span><span class="p">,</span>
                                        <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">(</span><span class="k">const</span> <span class="n">HttpResponsePtr</span> <span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span><span class="n">callback</span><span class="p">)</span><span class="k">override</span><span class="p">;</span>
    <span class="n">PATH_LIST_BEGIN</span>
    <span class="c1">//list path definitions here;</span>
    <span class="c1">//PATH_ADD(&quot;/path&quot;,&quot;filter1&quot;,&quot;filter2&quot;,HttpMethod1,HttpMethod2...);</span>
    <span class="n">PATH_LIST_END</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><strong>TestCtrl.cc</strong></span></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;TestCtrl.h&quot;</span><span class="cp"></span>
<span class="kt">void</span> <span class="n">TestCtrl</span><span class="o">::</span><span class="n">asyncHandleHttpRequest</span><span class="p">(</span><span class="k">const</span> <span class="n">HttpRequestPtr</span> <span class="o">&amp;</span><span class="n">req</span><span class="p">,</span>
                                    <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">(</span><span class="k">const</span> <span class="n">HttpResponsePtr</span> <span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span><span class="n">callback</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//write your application logic here</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Each HttpSimpleController class can only define one Http request handler, and it is defined by a virtual function override.</p>
<p>The route (or called mapping) from the URL path to the handler is done by a macro. You could add multipath mappings with the <em>PATH_ADD</em> macro. All <em>PATH_ADD</em> statements should be set between the <em>PATH_LIST_BEGIN</em> and <em>PATH_LIST_END</em> macro statements.</p>
<p>The first parameter is the path to be map, parameters behind the path are constraints on this path. Currently, two types of constraints are supported. One is the <em>HttpMethod</em> enum Type, which means the Http method allowed. The other type is the name of the <em>HttpFilter</em> class. One can configure any number of these two types of constraints and there are no order requirements for them. For Filter, please refer to Filter.</p>
<p>Users can register the same Simple Controller to multiple paths, or register multiple Simple Controllers on the same path (using different HTTP methods).</p>
<p>You could define an HttpResponse class variable, and then use the callback() to return it:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//write your application logic here</span>
<span class="k">auto</span> <span class="n">resp</span><span class="o">=</span><span class="n">HttpResponse</span><span class="o">::</span><span class="n">newHttpResponse</span><span class="p">();</span>
<span class="n">resp</span><span class="o">-&gt;</span><span class="n">setStatusCode</span><span class="p">(</span><span class="n">k200OK</span><span class="p">);</span>
<span class="n">resp</span><span class="o">-&gt;</span><span class="n">setContentTypeCode</span><span class="p">(</span><span class="n">CT_TEXT_HTML</span><span class="p">);</span>
<span class="n">resp</span><span class="o">-&gt;</span><span class="n">setBody</span><span class="p">(</span><span class="s">&quot;Your Page Contents&quot;</span><span class="p">);</span>
<span class="n">callback</span><span class="p">(</span><span class="n">resp</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>The mapping from the above path to the handler is done at compile time. In fact, the drogon framework also provides an interface for runtime completion mapping. The runtime mapping allows the user to map or modify the mapping through configuration files or other user interfaces without Recompile this program (For performance reasons, it is forbidden to add any controller mapping after running app().run() method).</strong></p>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>