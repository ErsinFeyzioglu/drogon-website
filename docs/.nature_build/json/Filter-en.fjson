{"parents": [{"link": "../index-en/", "title": "English documentation"}], "prev": {"link": "../Controller-WebSocketController-en/", "title": "Controller WebSocketController"}, "next": {"link": "../View-en/", "title": "View"}, "title": "Filter", "meta": {}, "body": "<div class=\"section\" id=\"filter\">\n<h1>Filter<a class=\"headerlink\" href=\"#filter\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>In HttpController\u2019s example, the getInfo method should check whether the user is logged in before returning the user\u2019s information. We can write this logic in the getInfo method, but obviously, checking the user\u2019s login membership is general logic which will be used by many interfaces, it should be extracted separately and configured before calling handler, which is what filters do. After the drogon framework completes the URL path matching, it first calls the filters registered on the path in turn, and only when all the filters allow \u201cpass\u201d, the corresponding handler will be called;</p>\n<div class=\"section\" id=\"built-in-filter\">\n<h2>Built-in Filter<a class=\"headerlink\" href=\"#built-in-filter\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Drogon contains the following common filters:</p>\n<blockquote>\n<div><ul class=\"simple\">\n<li><em>drogon::IntranetIpFilter</em>: allow HTTP requests from intranet IP only, or return the 404 page.</li>\n<li><em>drogon::LocalHostFilter</em>: allow HTTP requests from 127.0.0.1 or ::1 only, or return the 404 page.</li>\n</ul>\n</div></blockquote>\n</div>\n<div class=\"section\" id=\"custom-filter\">\n<h2>Custom Filter<a class=\"headerlink\" href=\"#custom-filter\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Of course, users can customize the filter, you need to inherit the HttpFilter class template, the template type is the subclass type, for example, if you want to create a LoginFilter, you could define it as follows:</p>\n<div class=\"highlight-cpp notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">class</span> <span class=\"nc\">LoginFilter</span><span class=\"o\">:</span><span class=\"k\">public</span> <span class=\"n\">drogon</span><span class=\"o\">::</span><span class=\"n\">HttpFilter</span><span class=\"o\">&lt;</span><span class=\"n\">LoginFilter</span><span class=\"o\">&gt;</span>\n<span class=\"p\">{</span>\n<span class=\"k\">public</span><span class=\"o\">:</span>\n    <span class=\"k\">virtual</span> <span class=\"kt\">void</span> <span class=\"n\">doFilter</span><span class=\"p\">(</span><span class=\"k\">const</span> <span class=\"n\">HttpRequestPtr</span> <span class=\"o\">&amp;</span><span class=\"n\">req</span><span class=\"p\">,</span>\n                        <span class=\"n\">FilterCallback</span> <span class=\"o\">&amp;&amp;</span><span class=\"n\">fcb</span><span class=\"p\">,</span>\n                        <span class=\"n\">FilterChainCallback</span> <span class=\"o\">&amp;&amp;</span><span class=\"n\">fccb</span><span class=\"p\">)</span> <span class=\"k\">override</span> <span class=\"p\">;</span>\n<span class=\"p\">};</span>\n</pre></div>\n</div>\n<p>You could create filter by the <em>drogon_ctl</em> command, see drogon_ctl.</p>\n<p>You need to override the doFilter virtual function of the parent class to implement the filter logic;</p>\n<p>This virtual function has three parameters, which are:</p>\n<blockquote>\n<div><ul class=\"simple\">\n<li><em>req</em>: http request;</li>\n<li><em>fcb</em>: filter callback function, the function type is void (HttpResponsePtr), when the filter determines that the request is not valid, the specific response is returned to the browser through this callback;</li>\n<li><em>fccb</em>: filter chain callback function, the function type is void (), when the filter determines that the request is legal, tells drogon to call the next filter or the final handler through this callback;</li>\n</ul>\n</div></blockquote>\n<p>The specific implementation can refer to the implementation of the drogon built-in filter.</p>\n</div>\n<div class=\"section\" id=\"filter-registration\">\n<h2>Filter Registration<a class=\"headerlink\" href=\"#filter-registration\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>The registration of filters is always accompanied by the registration of controllers.the macros (PATH_ADD, METHOD_ADD, etc.) mentioned earlier can add the name of one or more filters at the end; for example, we change the registration line of the previous <em>getInfo</em> method to the following form:</p>\n<div class=\"highlight-cpp notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">METHOD_ADD</span><span class=\"p\">(</span><span class=\"n\">User</span><span class=\"o\">::</span><span class=\"n\">getInfo</span><span class=\"p\">,</span><span class=\"s\">&quot;/{1}/info?token={2}&quot;</span><span class=\"p\">,</span><span class=\"n\">Get</span><span class=\"p\">,</span><span class=\"s\">&quot;LoginFilter&quot;</span><span class=\"p\">);</span>\n</pre></div>\n</div>\n<p>After the path is successfully matched, the <em>getInfo</em> method will be called only when the following conditions were met:</p>\n<blockquote>\n<div><ol class=\"arabic simple\">\n<li>The request must be an HTTP Get request;</li>\n<li>The requesting party must have logged in;</li>\n</ol>\n</div></blockquote>\n<p>As you can see, the configuration and registration of filters are very simple. The controller source file that registers filters does not need to include the filter\u2019s header file. The filter and controller are fully decoupled.</p>\n<div class=\"admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\">Note: If the filter is defined in the namespace, you must write the namespace completely when you register the filter.</p>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["View-en", "View", "N", "next"], ["Controller-WebSocketController-en", "Controller WebSocketController", "P", "previous"]], "sourcename": "Filter-en.rstd.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Filter</a><ul>\n<li><a class=\"reference internal\" href=\"#built-in-filter\">Built-in Filter</a></li>\n<li><a class=\"reference internal\" href=\"#custom-filter\">Custom Filter</a></li>\n<li><a class=\"reference internal\" href=\"#filter-registration\">Filter Registration</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rstd", "current_page_name": "Filter-en", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}