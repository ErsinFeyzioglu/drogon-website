
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>DataBase FastDbClient &#8212; drogon v1.0.0-beta21 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Plugins" href="../Plugins-en/" />
    <link rel="prev" title="DataBase ORM" href="../DataBase-ORM-en/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../Plugins-en/" title="Plugins"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../DataBase-ORM-en/" title="DataBase ORM"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../">drogon v1.0.0-beta21 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index-en/" accesskey="U">English documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="database-fastdbclient">
<h1>DataBase FastDbClient<a class="headerlink" href="#database-fastdbclient" title="Permalink to this headline">¶</a></h1>
<p>As the name implies, FastDbClient will provide higher performance than the normal DbClient. Unlike DbClient has own event loop, it shares the event loop with network IO threads and the main thread of the web application, which makes the internal implementation of FastDbClient available in a lock-free mode and more efficient.</p>
<p>Tests show that FastDbClient has a 10% to 20% performance improvement over DbClient under extremely high load conditions.</p>
<div class="section" id="create-and-get">
<h2>Create and Get<a class="headerlink" href="#create-and-get" title="Permalink to this headline">¶</a></h2>
<p>FastDbClient must be created automatically by the framework with the configuration file, or by calling the app.createDbClient() interface:</p>
<p>The sub-option <em>is_fast</em> of the db_client option in the configuration file indicates if the client is a FastDbClient.Or user can create a FastDbClient by calling the app.createDbClient() method with the last parameter set to true.</p>
<p>The framework creates a separate FastDbClient for each IO’s event loop and the main event loop, and each FastDbClient manages several database connections internally. The number of event loop of IO is controlled by the framework’s “threads_num” option, which is generally set to the number of CPU cores of the host. The number of the DB connections per event loop is the value of the DB client “connection_number” option. Please refer to Configuration File. Therefore, the total number of DB connections held by FastDbClient is <em>(threads_num+1) * connection_number</em>.</p>
<p>The interface to get a FastDbClient is similar to the normal DbClient, as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">orm</span><span class="o">::</span><span class="n">DbClientPtr</span> <span class="n">getFastDbClient</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;default&quot;</span><span class="p">);</span>
<span class="c1">/// Use drogon::app().getFastDbCLient(&quot;clientName&quot;) to get a FastDbClient object.</span>
</pre></div>
</div>
<p>It should be pointed out that due to the special nature of FastDbClient, the user must call the above interface in the IO event loop thread or the main thread to get the correct smart pointer. In other threads, only the null pointer can be obtained and cannot be used.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The use of FastDbClient is almost identical to that of the normal DbClient, except for the following limitations:</p>
<blockquote>
<div><ul class="simple">
<li>Both the get and the use of it must be in the framework’s IO event loop thread or the main thread. If it is used in other threads, there will be unpredictable errors (because the lock-free condition is destroyed). Fortunately, most of the application programming is in the IO thread, such as within the processing functions of various controllers, within the filter function of filters. It is easy to know that the various callback functions of the FastDbClient interface are also in the current IO thread, and can be safely nestedly used.</li>
<li>Never use the blocking interface of FastDbClient, because this interface will block the current thread, and the current thread is also the thread that handles the database IO of this object, which will cause permanent blocking, and the user has no chance to get the result.</li>
<li>Synchronous transaction creation interfaces are likely to block (when all connections are busy), so FastDbClient’s synchronous transaction creation interface returns null pointers directly. If you want to use transactions on FastDbClient, please use the asynchronous transaction creation interface.</li>
<li>After using the FastDbClient to create an Orm Mapper object, you should also use only asynchronous non-blocking interfaces of the mapper object.</li>
</ul>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">DataBase FastDbClient</a><ul>
<li><a class="reference internal" href="#create-and-get">Create and Get</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../DataBase-ORM-en/"
                        title="previous chapter">DataBase ORM</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../Plugins-en/"
                        title="next chapter">Plugins</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Database-FastDbclient-en.rstd.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../Plugins-en/" title="Plugins"
             >next</a> |</li>
        <li class="right" >
          <a href="../DataBase-ORM-en/" title="DataBase ORM"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../">drogon v1.0.0-beta21 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index-en/" >English documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, an-tao.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>