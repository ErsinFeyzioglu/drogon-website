
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AOP Aspect Oriented Programming &#8212; drogon v1.0.0-beta21 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Benchmarks" href="../Benchmarks-en/" />
    <link rel="prev" title="drogon_ctl Command" href="../Drogon_ctl-Command-en/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../Benchmarks-en/" title="Benchmarks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../Drogon_ctl-Command-en/" title="drogon_ctl Command"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../">drogon v1.0.0-beta21 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index-en/" accesskey="U">English documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="aop-aspect-oriented-programming">
<h1>AOP Aspect Oriented Programming<a class="headerlink" href="#aop-aspect-oriented-programming" title="Permalink to this headline">¶</a></h1>
<p>AOP(Aspect Oriented Programming) is a programming paradigm that aims to increase modularity by allowing the separation of cross-cutting concerns(Quoted from Wikipedia).</p>
<p>Limited to the features of the C++ language, Drogon does not provide a flexible AOP solution like Spring, but a simple AOP in which all join points are predefined in the framework, and by using the framework’s AOP series interfaces, one can register handlers(called ‘advices’ in Drogon) onto specific join points.</p>
<div class="section" id="predefined-joinpoints">
<h2>Predefined joinpoints<a class="headerlink" href="#predefined-joinpoints" title="Permalink to this headline">¶</a></h2>
<p>Drogon provides seven joinpoints for users. When the application runs to the joinpoints, the user-registered handlers(Advices) are called one by one. The description of these joinpoints is as follows:</p>
<blockquote>
<div><ul class="simple">
<li>Beginning: As the name implies, the joinpoint is at the beginning of the program. Specifically, all handlers registered at this joinpoint are executed immediately after the app().run() method has finished initializaiton. At this joinpoint, all the controllers, filters, plugins, and database clients have been built completely, users can get the desired object reference or perform some other initialization work here. The advice on the joinpoint is only run once, the call signature of the adivice is <em>void()</em>, the registration interface is <em>registerBeginningAdvice</em>;</li>
<li>NewConnection: Advices registered to this joinpoint are called when each new TCP connection is established. The call signature of the advice is <em>bool(const trantor::InetAddress &amp;, const trantor::InetAddress &amp;)</em>, where the first argument is the remote address of the TCP connection and the second one is the local address. Note that the return type is bool, if the user returns false, the corresponding connection will be disconnected. The registration interface is registerNewConnectionAdvice;</li>
<li>HttpResponseCreation: Advices registered to this joinpoint are called when each HTTP Response object is created. The call signature of the Advice is <em>void(const HttpResponsePtr &amp;)</em>, where the parameter is the newly created object, and the user can perform some unified operations on all Responses with this joinpoint, such as adding a special header, etc. This joinpoint affects all Responses, including 404 or any drogon internal error response, and also including all responses generated by user’s application. The registration interface is <em>registerHttpResponseCreationAdvice</em>;</li>
<li>Sync: This joinpoint is located at the front end of Http request processing. Users can intercept this request by returning a non-empty Response object. The call signature of Advices is <em>HttpRequestPtr(const HttpRequestPtr &amp;)</em>. The registration interface is <em>‘registerSyncAdvice’</em>.</li>
<li>Pre-Routing: Advices registered to this joinpoint are called immediately after the request is created and before it matches any handler paths. Advices for the joinpoint have two call signatures, <em>void(const HttpRequestPtr &amp;,AdviceCallback &amp;&amp;,AdviceChainCallback &amp;&amp;)</em> and <em>void(const HttpRequestPtr &amp;)</em>, the previous one is exactly the same as the call signature of the filter’s <em>doFilter</em> method. In fact, they all run in the same way (please refer to [05-Filter]), users can intercept the client request or let it pass through this joinpoint. The advice with second call signature has no interception capability, but the overhead of it is lower, if the user does not intend to intercept requests, please select this kind of advices. The registration interface is <em>registerPreRoutingAdvice</em>;</li>
<li>Post-Routing: Advices registered to this joinpoint are called immediately after the request matchs a handler path, The call signatures of Advices are the same as the above joinpoint’s. The registration interface is <em>registerPostRoutingAdvice</em>;</li>
<li>Pre-Handling: Advices registered to this joinpoint are called immediately after the request is approved by all filters and before it is handled, The call signatures of Advices are the same as the above joinpoint’s. The registration interface is <em>registerPostRoutingAdvice</em>;</li>
<li>Post-Handling: Advices registered to this joinpoint are called immediately after the request is handled and a response object is created by the handler, The call signature of Advices is <em>void(const HttpRequestPtr &amp;, const HttpResponsePtr &amp;)</em>, The registration interface is <em>registerPostHandlingAdvice</em>;</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="aop-schematic">
<h2>AOP schematic<a class="headerlink" href="#aop-schematic" title="Permalink to this headline">¶</a></h2>
<p>The following figure shows the location of the above four joinpoints in the HTTP Requests processing flow, where the red dots represent the joinpoints and the green arrows represent the asynchronous calls.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">AOP Aspect Oriented Programming</a><ul>
<li><a class="reference internal" href="#predefined-joinpoints">Predefined joinpoints</a></li>
<li><a class="reference internal" href="#aop-schematic">AOP schematic</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../Drogon_ctl-Command-en/"
                        title="previous chapter">drogon_ctl Command</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../Benchmarks-en/"
                        title="next chapter">Benchmarks</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/AOP-Aspect-Oriented-Programming-en.rstd.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../Benchmarks-en/" title="Benchmarks"
             >next</a> |</li>
        <li class="right" >
          <a href="../Drogon_ctl-Command-en/" title="drogon_ctl Command"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../">drogon v1.0.0-beta21 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index-en/" >English documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, an-tao.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>