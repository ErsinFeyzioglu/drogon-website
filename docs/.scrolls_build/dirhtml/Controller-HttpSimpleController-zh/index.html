
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>控制器 HttpSimpleController &#8212; drogon v1.0.0-beta21 documentation</title>
  
    <link rel="stylesheet" href="../_static/scrolls.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/theme_extras.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="HttpController 控制器" href="../Controller-HttpController-zh/" />
    <link rel="prev" title="控制器 简介" href="../Controller-Introduction-zh/" /> 
  </head><body>
    <div id="content">
      <div class="header">
        <h1 class="heading"><a href="../"
          title="back to the documentation overview"><span>控制器 HttpSimpleController</span></a></h1>
      </div>
      <div class="relnav" role="navigation" aria-label="related navigation">
        <a href="../Controller-Introduction-zh/">&laquo; 控制器 简介</a> |
        <a href="#">控制器 HttpSimpleController</a>
        | <a href="../Controller-HttpController-zh/">HttpController 控制器 &raquo;</a>
      </div>
      <div id="contentwrapper">
        
  <div class="section" id="httpsimplecontroller">
<h1>控制器 HttpSimpleController<a class="headerlink" href="#httpsimplecontroller" title="Permalink to this headline">¶</a></h1>
<p>可以由*drogon_ctl*命令行工具快速生成基于*HttpSimpleController*的自定义类的源文件，命令格式如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>drogon_ctl create controller &lt;<span class="o">[</span>namespace::<span class="o">]</span>class_name&gt;
</pre></div>
</div>
<p>我们创建一个名称为*TestCtrl*的控制器：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>drogon_ctl create controller TestCtrl
</pre></div>
</div>
<p>可以看到，目录下新增加了两个文件，TestCtrl.h和TestCtrl.cc，下面阐述一下这两个文件。</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><strong>TestCtrl.h：</strong></span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>
<span class="cp">#include</span> <span class="cpf">&lt;drogon/HttpSimpleController.h&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">drogon</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">TestCtrl</span><span class="o">:</span><span class="k">public</span> <span class="n">drogon</span><span class="o">::</span><span class="n">HttpSimpleController</span><span class="o">&lt;</span><span class="n">TestCtrl</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">asyncHandleHttpRequest</span><span class="p">(</span><span class="k">const</span> <span class="n">HttpRequestPtr</span> <span class="o">&amp;</span><span class="n">req</span><span class="p">,</span>
                                        <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">(</span><span class="k">const</span> <span class="n">HttpResponsePtr</span> <span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span><span class="n">callback</span><span class="p">)</span><span class="k">override</span><span class="p">;</span>
    <span class="n">PATH_LIST_BEGIN</span>
    <span class="c1">//list path definitions here;</span>
    <span class="c1">//PATH_ADD(&quot;/path&quot;,&quot;filter1&quot;,&quot;filter2&quot;,HttpMethod1,HttpMethod2...);</span>
    <span class="n">PATH_LIST_END</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><strong>TestCtrl.cc</strong></span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;TestCtrl.h&quot;</span><span class="cp"></span>
<span class="kt">void</span> <span class="n">TestCtrl</span><span class="o">::</span><span class="n">asyncHandleHttpRequest</span><span class="p">(</span><span class="k">const</span> <span class="n">HttpRequestPtr</span> <span class="o">&amp;</span><span class="n">req</span><span class="p">,</span>
                                    <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">(</span><span class="k">const</span> <span class="n">HttpResponsePtr</span> <span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span><span class="n">callback</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//write your application logic here</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>每个HttpSimpleController类只能定义一个Http请求处理函数(handler)，而且通过虚函数重载定义。</p>
<p>从URL路径到处理函数的路由(或称映射)由宏完成，可以用*PATH_ADD*宏添加多重路径映射，所有*PATH_ADD*语句应夹在*PATH_LIST_BEGIN*和*PATH_LIST_END*宏语句之间。</p>
<p>第一个参数是映射的路径,路径后面的参数是对这个路径的约束，目前支持两种约束，一种是HttpMethod类型，表示该路径允许使用的Http方法，可以配置零个或多个，一种是HttpFilter类的名字，这种对象执行特定的过滤操作，也可以配置0个或多个，两种类型没有顺序要求，框架会处理好类型的匹配。关于Filter，请参阅过滤器Filter.</p>
<p>用户可以把同一个Simple Controller注册到多个路径上，也可以在同一个路径上注册多个Simple Controller（通过HTTP method区分）。</p>
<p>你可以定义一个HttpResponse类的变量，然后使用callback()返回这个变量即可:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//write your application logic here</span>
<span class="k">auto</span> <span class="n">resp</span><span class="o">=</span><span class="n">HttpResponse</span><span class="o">::</span><span class="n">newHttpResponse</span><span class="p">();</span>
<span class="n">resp</span><span class="o">-&gt;</span><span class="n">setStatusCode</span><span class="p">(</span><span class="n">k200OK</span><span class="p">);</span>
<span class="n">resp</span><span class="o">-&gt;</span><span class="n">setContentTypeCode</span><span class="p">(</span><span class="n">CT_TEXT_HTML</span><span class="p">);</span>
<span class="n">resp</span><span class="o">-&gt;</span><span class="n">setBody</span><span class="p">(</span><span class="s">&quot;Your Page Contents&quot;</span><span class="p">);</span>
<span class="n">callback</span><span class="p">(</span><span class="n">resp</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>上述路径到处理函数的映射是在编译期完成的，事实上，drogon框架也提供了运行期完成映射的接口，运行期映射可以让用户通过配置文件或其它用户接口完成映射或修改映射关系而无需重新编译这个程序(出于性能的考虑，禁止在运行app().run()之后再注册任何映射)。</strong></p>
</div>


      </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, an-tao.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>